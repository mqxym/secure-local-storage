var On=Object.create;var{getPrototypeOf:Cn,defineProperty:b,getOwnPropertyNames:wA,getOwnPropertyDescriptor:Qn}=Object,NA=Object.prototype.hasOwnProperty;var bA=(A,n,t)=>{t=A!=null?On(Cn(A)):{};let j=n||!A||!A.__esModule?b(t,"default",{value:A,enumerable:!0}):t;for(let i of wA(A))if(!NA.call(j,i))b(j,i,{get:()=>A[i],enumerable:!0});return j},zA=new WeakMap,MA=(A)=>{var n=zA.get(A),t;if(n)return n;if(n=b({},"__esModule",{value:!0}),A&&typeof A==="object"||typeof A==="function")wA(A).map((j)=>!NA.call(n,j)&&b(n,j,{get:()=>A[j],enumerable:!(t=Qn(A,j))||t.enumerable}));return zA.set(A,n),n},yA=(A,n)=>()=>(n||A((n={exports:{}}).exports,n),n.exports);var Yn=(A,n)=>{for(var t in n)b(A,t,{get:n[t],enumerable:!0,configurable:!0,set:(j)=>n[t]=()=>j})};var Zn=(A,n)=>()=>(A&&(n=A(A=0)),n);var TA=((A)=>typeof require<"u"?require:typeof Proxy<"u"?new Proxy(A,{get:(n,t)=>(typeof require<"u"?require:n)[t]}):A)(function(A){if(typeof require<"u")return require.apply(this,arguments);throw Error('Dynamic require of "'+A+'" is not supported')});var GA={};Yn(GA,{sep:()=>un,resolve:()=>sA,relative:()=>An,posix:()=>qn,parse:()=>en,normalize:()=>mA,join:()=>dA,isAbsolute:()=>SA,format:()=>fn,extname:()=>rn,dirname:()=>tn,delimiter:()=>cn,default:()=>Vn,basename:()=>jn,_makeLong:()=>nn});function U(A){if(typeof A!=="string")throw TypeError("Path must be a string. Received "+JSON.stringify(A))}function pA(A,n){var t="",j=0,i=-1,r=0,e;for(var u=0;u<=A.length;++u){if(u<A.length)e=A.charCodeAt(u);else if(e===47)break;else e=47;if(e===47){if(i===u-1||r===1);else if(i!==u-1&&r===2){if(t.length<2||j!==2||t.charCodeAt(t.length-1)!==46||t.charCodeAt(t.length-2)!==46){if(t.length>2){var E=t.lastIndexOf("/");if(E!==t.length-1){if(E===-1)t="",j=0;else t=t.slice(0,E),j=t.length-1-t.lastIndexOf("/");i=u,r=0;continue}}else if(t.length===2||t.length===1){t="",j=0,i=u,r=0;continue}}if(n){if(t.length>0)t+="/..";else t="..";j=2}}else{if(t.length>0)t+="/"+A.slice(i+1,u);else t=A.slice(i+1,u);j=u-i-1}i=u,r=0}else if(e===46&&r!==-1)++r;else r=-1}return t}function Wn(A,n){var t=n.dir||n.root,j=n.base||(n.name||"")+(n.ext||"");if(!t)return j;if(t===n.root)return t+j;return t+A+j}function sA(){var A="",n=!1,t;for(var j=arguments.length-1;j>=-1&&!n;j--){var i;if(j>=0)i=arguments[j];else{if(t===void 0)t=process.cwd();i=t}if(U(i),i.length===0)continue;A=i+"/"+A,n=i.charCodeAt(0)===47}if(A=pA(A,!n),n)if(A.length>0)return"/"+A;else return"/";else if(A.length>0)return A;else return"."}function mA(A){if(U(A),A.length===0)return".";var n=A.charCodeAt(0)===47,t=A.charCodeAt(A.length-1)===47;if(A=pA(A,!n),A.length===0&&!n)A=".";if(A.length>0&&t)A+="/";if(n)return"/"+A;return A}function SA(A){return U(A),A.length>0&&A.charCodeAt(0)===47}function dA(){if(arguments.length===0)return".";var A;for(var n=0;n<arguments.length;++n){var t=arguments[n];if(U(t),t.length>0)if(A===void 0)A=t;else A+="/"+t}if(A===void 0)return".";return mA(A)}function An(A,n){if(U(A),U(n),A===n)return"";if(A=sA(A),n=sA(n),A===n)return"";var t=1;for(;t<A.length;++t)if(A.charCodeAt(t)!==47)break;var j=A.length,i=j-t,r=1;for(;r<n.length;++r)if(n.charCodeAt(r)!==47)break;var e=n.length,u=e-r,E=i<u?i:u,k=-1,s=0;for(;s<=E;++s){if(s===E){if(u>E){if(n.charCodeAt(r+s)===47)return n.slice(r+s+1);else if(s===0)return n.slice(r+s)}else if(i>E){if(A.charCodeAt(t+s)===47)k=s;else if(s===0)k=0}break}var h=A.charCodeAt(t+s),$=n.charCodeAt(r+s);if(h!==$)break;else if(h===47)k=s}var _="";for(s=t+k+1;s<=j;++s)if(s===j||A.charCodeAt(s)===47)if(_.length===0)_+="..";else _+="/..";if(_.length>0)return _+n.slice(r+k);else{if(r+=k,n.charCodeAt(r)===47)++r;return n.slice(r)}}function nn(A){return A}function tn(A){if(U(A),A.length===0)return".";var n=A.charCodeAt(0),t=n===47,j=-1,i=!0;for(var r=A.length-1;r>=1;--r)if(n=A.charCodeAt(r),n===47){if(!i){j=r;break}}else i=!1;if(j===-1)return t?"/":".";if(t&&j===1)return"//";return A.slice(0,j)}function jn(A,n){if(n!==void 0&&typeof n!=="string")throw TypeError('"ext" argument must be a string');U(A);var t=0,j=-1,i=!0,r;if(n!==void 0&&n.length>0&&n.length<=A.length){if(n.length===A.length&&n===A)return"";var e=n.length-1,u=-1;for(r=A.length-1;r>=0;--r){var E=A.charCodeAt(r);if(E===47){if(!i){t=r+1;break}}else{if(u===-1)i=!1,u=r+1;if(e>=0)if(E===n.charCodeAt(e)){if(--e===-1)j=r}else e=-1,j=u}}if(t===j)j=u;else if(j===-1)j=A.length;return A.slice(t,j)}else{for(r=A.length-1;r>=0;--r)if(A.charCodeAt(r)===47){if(!i){t=r+1;break}}else if(j===-1)i=!1,j=r+1;if(j===-1)return"";return A.slice(t,j)}}function rn(A){U(A);var n=-1,t=0,j=-1,i=!0,r=0;for(var e=A.length-1;e>=0;--e){var u=A.charCodeAt(e);if(u===47){if(!i){t=e+1;break}continue}if(j===-1)i=!1,j=e+1;if(u===46){if(n===-1)n=e;else if(r!==1)r=1}else if(n!==-1)r=-1}if(n===-1||j===-1||r===0||r===1&&n===j-1&&n===t+1)return"";return A.slice(n,j)}function fn(A){if(A===null||typeof A!=="object")throw TypeError('The "pathObject" argument must be of type Object. Received type '+typeof A);return Wn("/",A)}function en(A){U(A);var n={root:"",dir:"",base:"",ext:"",name:""};if(A.length===0)return n;var t=A.charCodeAt(0),j=t===47,i;if(j)n.root="/",i=1;else i=0;var r=-1,e=0,u=-1,E=!0,k=A.length-1,s=0;for(;k>=i;--k){if(t=A.charCodeAt(k),t===47){if(!E){e=k+1;break}continue}if(u===-1)E=!1,u=k+1;if(t===46){if(r===-1)r=k;else if(s!==1)s=1}else if(r!==-1)s=-1}if(r===-1||u===-1||s===0||s===1&&r===u-1&&r===e+1){if(u!==-1)if(e===0&&j)n.base=n.name=A.slice(1,u);else n.base=n.name=A.slice(e,u)}else{if(e===0&&j)n.name=A.slice(1,r),n.base=A.slice(1,u);else n.name=A.slice(e,r),n.base=A.slice(e,u);n.ext=A.slice(r,u)}if(e>0)n.dir=A.slice(0,e-1);else if(j)n.dir="/";return n}var un="/",cn=":",qn,Vn;var HA=Zn(()=>{qn=((A)=>(A.posix=A,A))({resolve:sA,normalize:mA,isAbsolute:SA,join:dA,relative:An,_makeLong:nn,dirname:tn,basename:jn,extname:rn,format:fn,parse:en,sep:un,delimiter:cn,win32:null,posix:null}),Vn=qn});var OA=yA((Nt,X)=>{var __dirname="/Users/maxim/Projects/Private/Packages/secure-local-storage/node_modules/argon2-browser/dist",f=typeof self<"u"&&typeof self.Module<"u"?self.Module:{},zn=f,S={},K;for(K in f)if(f.hasOwnProperty(K))S[K]=f[K];var d=[],vn="./this.program",LA=function(A,n){throw n},lA=!1,P=!1,PA=!1,gn=!1;lA=typeof window==="object";P=typeof importScripts==="function";PA=typeof process==="object"&&typeof process.versions==="object"&&typeof process.versions.node==="string";gn=!lA&&!PA&&!P;var m="";function wn(A){if(f.locateFile)return f.locateFile(A,m);return m+A}var kA,KA,AA,Nn,aA,UA;if(PA){if(P)m=(HA(),MA(GA)).dirname(m)+"/";else m=__dirname+"/";if(kA=function(n,t){if(!aA)aA=(()=>({}));if(!UA)UA=(HA(),MA(GA));return n=UA.normalize(n),aA.readFileSync(n,t?null:"utf8")},AA=function(n){var t=kA(n,!0);if(!t.buffer)t=new Uint8Array(t);return En(t.buffer),t},process.argv.length>1)vn=process.argv[1].replace(/\\/g,"/");if(d=process.argv.slice(2),typeof X<"u")X.exports=f;process.on("uncaughtException",function(A){if(!(A instanceof mt))throw A}),process.on("unhandledRejection",rA),LA=function(A){process.exit(A)},f.inspect=function(){return"[Emscripten Module object]"}}else if(gn){if(typeof read<"u")kA=function(n){return read(n)};if(AA=function(n){var t;if(typeof readbuffer==="function")return new Uint8Array(readbuffer(n));return t=read(n,"binary"),En(typeof t==="object"),t},typeof scriptArgs<"u")d=scriptArgs;else if(typeof arguments<"u")d=arguments;if(typeof quit==="function")LA=function(A){quit(A)};if(typeof print<"u"){if(typeof console>"u")console={};console.log=print,console.warn=console.error=typeof printErr<"u"?printErr:print}}else if(lA||P){if(P)m=self.location.href;else if(typeof document<"u"&&document.currentScript)m=document.currentScript.src;if(m.indexOf("blob:")!==0)m=m.substr(0,m.lastIndexOf("/")+1);else m="";{if(kA=function(A){var n=new XMLHttpRequest;return n.open("GET",A,!1),n.send(null),n.responseText},P)AA=function(A){var n=new XMLHttpRequest;return n.open("GET",A,!1),n.responseType="arraybuffer",n.send(null),new Uint8Array(n.response)};KA=function(A,n,t){var j=new XMLHttpRequest;j.open("GET",A,!0),j.responseType="arraybuffer",j.onload=function(){if(j.status==200||j.status==0&&j.response){n(j.response);return}t()},j.onerror=t,j.send(null)}}Nn=function(A){document.title=A}}var Vt=f.print||console.log.bind(console),p=f.printErr||console.warn.bind(console);for(K in S)if(S.hasOwnProperty(K))f[K]=S[K];S=null;if(f.arguments)d=f.arguments;if(f.thisProgram)vn=f.thisProgram;if(f.quit)LA=f.quit;var tA;if(f.wasmBinary)tA=f.wasmBinary;var zt=f.noExitRuntime||!0;if(typeof WebAssembly!=="object")rA("no native wasm support detected");var jA,ln=!1,bn;function En(A,n){if(!A)rA("Assertion failed: "+n)}var Mn=0,Tn=1;function pn(A,n){var t;if(n==Tn)t=xn(A.length);else t=Un(A.length);if(A.subarray||A.slice)D.set(A,t);else D.set(new Uint8Array(A),t);return t}var sn=typeof TextDecoder<"u"?new TextDecoder("utf8"):void 0;function Sn(A,n,t){var j=n+t,i=n;while(A[i]&&!(i>=j))++i;if(i-n>16&&A.subarray&&sn)return sn.decode(A.subarray(n,i));else{var r="";while(n<i){var e=A[n++];if(!(e&128)){r+=String.fromCharCode(e);continue}var u=A[n++]&63;if((e&224)==192){r+=String.fromCharCode((e&31)<<6|u);continue}var E=A[n++]&63;if((e&240)==224)e=(e&15)<<12|u<<6|E;else e=(e&7)<<18|u<<12|E<<6|A[n++]&63;if(e<65536)r+=String.fromCharCode(e);else{var k=e-65536;r+=String.fromCharCode(55296|k>>10,56320|k&1023)}}}return r}function dn(A,n){return A?Sn(D,A,n):""}function At(A,n){if(A%n>0)A+=n-A%n;return A}var JA,hn,D,on,In,$n,_n,yn,Fn;function Rn(A){JA=A,f.HEAP8=hn=new Int8Array(A),f.HEAP16=on=new Int16Array(A),f.HEAP32=$n=new Int32Array(A),f.HEAPU8=D=new Uint8Array(A),f.HEAPU16=In=new Uint16Array(A),f.HEAPU32=_n=new Uint32Array(A),f.HEAPF32=yn=new Float32Array(A),f.HEAPF64=Fn=new Float64Array(A)}var wt=f.INITIAL_MEMORY||16777216,vA,Bn=[],mn=[],Gn=[],nt=!1;function tt(){if(f.preRun){if(typeof f.preRun=="function")f.preRun=[f.preRun];while(f.preRun.length)it(f.preRun.shift())}DA(Bn)}function jt(){nt=!0,DA(mn)}function rt(){if(f.postRun){if(typeof f.postRun=="function")f.postRun=[f.postRun];while(f.postRun.length)et(f.postRun.shift())}DA(Gn)}function it(A){Bn.unshift(A)}function ft(A){mn.unshift(A)}function et(A){Gn.unshift(A)}var J=0,xA=null,nA=null;function ut(A){if(J++,f.monitorRunDependencies)f.monitorRunDependencies(J)}function ct(A){if(J--,f.monitorRunDependencies)f.monitorRunDependencies(J);if(J==0){if(xA!==null)clearInterval(xA),xA=null;if(nA){var n=nA;nA=null,n()}}}f.preloadedImages={};f.preloadedAudios={};function rA(A){if(f.onAbort)f.onAbort(A);A+="",p(A),ln=!0,bn=1,A="abort("+A+"). Build with -s ASSERTIONS=1 for more info.";var n=new WebAssembly.RuntimeError(A);throw n}var qt="data:application/octet-stream;base64,";function Hn(A){return A.startsWith(qt)}function an(A){return A.startsWith("file://")}var F="argon2.wasm";if(!Hn(F))F=wn(F);function kn(A){try{if(A==F&&tA)return new Uint8Array(tA);if(AA)return AA(A);else throw"both async and sync fetching of the wasm failed"}catch(n){rA(n)}}function Et(){if(!tA&&(lA||P)){if(typeof fetch==="function"&&!an(F))return fetch(F,{credentials:"same-origin"}).then(function(A){if(!A.ok)throw"failed to load wasm binary file at '"+F+"'";return A.arrayBuffer()}).catch(function(){return kn(F)});else if(KA)return new Promise(function(A,n){KA(F,function(t){A(new Uint8Array(t))},n)})}return Promise.resolve().then(function(){return kn(F)})}function st(){var A={a:lt};function n(e,u){var E=e.exports;f.asm=E,jA=f.asm.c,Rn(jA.buffer),vA=f.asm.k,ft(f.asm.d),ct("wasm-instantiate")}ut("wasm-instantiate");function t(e){n(e.instance)}function j(e){return Et().then(function(u){var E=WebAssembly.instantiate(u,A);return E}).then(e,function(u){p("failed to asynchronously prepare wasm: "+u),rA(u)})}function i(){if(!tA&&typeof WebAssembly.instantiateStreaming==="function"&&!Hn(F)&&!an(F)&&typeof fetch==="function")return fetch(F,{credentials:"same-origin"}).then(function(e){var u=WebAssembly.instantiateStreaming(e,A);return u.then(t,function(E){return p("wasm streaming compile failed: "+E),p("falling back to ArrayBuffer instantiation"),j(t)})});else return j(t)}if(f.instantiateWasm)try{var r=f.instantiateWasm(A,n);return r}catch(e){return p("Module.instantiateWasm callback failed with error: "+e),!1}return i(),{}}function DA(A){while(A.length>0){var n=A.shift();if(typeof n=="function"){n(f);continue}var t=n.func;if(typeof t==="number")if(n.arg===void 0)vA.get(t)();else vA.get(t)(n.arg);else t(n.arg===void 0?null:n.arg)}}function kt(A,n,t){D.copyWithin(A,n,n+t)}function vt(A){try{return jA.grow(A-JA.byteLength+65535>>>16),Rn(jA.buffer),1}catch(n){}}function gt(A){var n=D.length;A=A>>>0;var t=2147418112;if(A>t)return!1;for(var j=1;j<=4;j*=2){var i=n*(1+0.2/j);i=Math.min(i,A+100663296);var r=Math.min(t,At(Math.max(A,i),65536)),e=vt(r);if(e)return!0}return!1}var lt={a:kt,b:gt},ht=st(),ot=f.___wasm_call_ctors=function(){return(ot=f.___wasm_call_ctors=f.asm.d).apply(null,arguments)},It=f._argon2_hash=function(){return(It=f._argon2_hash=f.asm.e).apply(null,arguments)},Un=f._malloc=function(){return(Un=f._malloc=f.asm.f).apply(null,arguments)},$t=f._free=function(){return($t=f._free=f.asm.g).apply(null,arguments)},_t=f._argon2_verify=function(){return(_t=f._argon2_verify=f.asm.h).apply(null,arguments)},yt=f._argon2_error_message=function(){return(yt=f._argon2_error_message=f.asm.i).apply(null,arguments)},Ft=f._argon2_encodedlen=function(){return(Ft=f._argon2_encodedlen=f.asm.j).apply(null,arguments)},Rt=f._argon2_hash_ext=function(){return(Rt=f._argon2_hash_ext=f.asm.l).apply(null,arguments)},Bt=f._argon2_verify_ext=function(){return(Bt=f._argon2_verify_ext=f.asm.m).apply(null,arguments)},xn=f.stackAlloc=function(){return(xn=f.stackAlloc=f.asm.n).apply(null,arguments)};f.allocate=pn;f.UTF8ToString=dn;f.ALLOC_NORMAL=Mn;var gA;function mt(A){this.name="ExitStatus",this.message="Program terminated with exit("+A+")",this.status=A}nA=function A(){if(!gA)XA();if(!gA)nA=A};function XA(A){if(A=A||d,J>0)return;if(tt(),J>0)return;function n(){if(gA)return;if(gA=!0,f.calledRun=!0,ln)return;if(jt(),f.onRuntimeInitialized)f.onRuntimeInitialized();rt()}if(f.setStatus)f.setStatus("Running..."),setTimeout(function(){setTimeout(function(){f.setStatus("")},1),n()},1);else n()}f.run=XA;if(f.preInit){if(typeof f.preInit=="function")f.preInit=[f.preInit];while(f.preInit.length>0)f.preInit.pop()()}XA();if(typeof X<"u")X.exports=f;f.unloadRuntime=function(){if(typeof self<"u")delete self.Module;if(f=zn=jA=vA=ht=JA=hn=D=on=In=$n=_n=yn=Fn=void 0,typeof X<"u")delete X.exports}});var Ln=yA((bt,Gt)=>{Gt.exports="./argon2.wasm"});var Pn=yA((Kn,hA)=>{(function(A,n){if(typeof define==="function"&&define.amd)define([],n);else if(typeof hA==="object"&&hA.exports)hA.exports=n();else A.argon2=n()})(typeof self<"u"?self:Kn,function(){let A=typeof self<"u"?self:this,n={Argon2d:0,Argon2i:1,Argon2id:2};function t(q){if(t._promise)return t._promise;if(t._module)return Promise.resolve(t._module);let g;if(A.process&&A.process.versions&&A.process.versions.node)g=i().then((v)=>new Promise((I)=>{v.postRun=()=>I(v)}));else g=r().then((v)=>{let I=q?u(q):void 0;return j(v,I)});return t._promise=g,g.then((v)=>{return t._module=v,delete t._promise,v})}function j(q,g){return new Promise((v)=>{return A.Module={wasmBinary:q,wasmMemory:g,postRun(){v(Module)}},i()})}function i(){if(A.loadArgon2WasmModule)return A.loadArgon2WasmModule();return Promise.resolve(OA())}function r(){if(A.loadArgon2WasmBinary)return A.loadArgon2WasmBinary();return Promise.resolve(Ln()).then((g)=>{return e(g)})}function e(q){let g=atob(q),v=new Uint8Array(new ArrayBuffer(g.length));for(let I=0;I<g.length;I++)v[I]=g.charCodeAt(I);return v}function u(q){let C=Math.min(Math.max(Math.ceil(q*1024/65536),256)+256,32767);return new WebAssembly.Memory({initial:C,maximum:32767})}function E(q,g){return q.allocate(g,"i8",q.ALLOC_NORMAL)}function k(q,g){let v=new Uint8Array([...g,0]);return E(q,v)}function s(q){if(typeof q!=="string")return q;if(typeof TextEncoder==="function")return new TextEncoder().encode(q);else if(typeof Buffer==="function")return Buffer.from(q);else throw Error("Don't know how to encode UTF8")}function h(q){let g=q.mem||1024;return t(g).then((v)=>{let I=q.time||1,V=q.parallelism||1,z=s(q.pass),C=k(v,z),$A=z.length,iA=s(q.salt),fA=k(v,iA),w=iA.length,Q=q.type||n.Argon2d,H=v.allocate(Array(q.hashLen||24),"i8",v.ALLOC_NORMAL),L=q.secret?E(v,q.secret):0,N=q.secret?q.secret.byteLength:0,R=q.ad?E(v,q.ad):0,Dn=q.ad?q.ad.byteLength:0,eA=q.hashLen||24,ZA=v._argon2_encodedlen(I,g,V,w,eA,Q),_A=v.allocate(Array(ZA+1),"i8",v.ALLOC_NORMAL),xt=19,Y,uA;try{uA=v._argon2_hash_ext(I,g,V,C,$A,fA,w,H,eA,_A,ZA,Q,L,N,R,Dn,19)}catch(Z){Y=Z}let cA;if(uA===0&&!Y){let Z="",WA=new Uint8Array(eA);for(let qA=0;qA<eA;qA++){let VA=v.HEAP8[H+qA];WA[qA]=VA,Z+=("0"+(255&VA).toString(16)).slice(-2)}let Xn=v.UTF8ToString(_A);cA={hash:WA,hashHex:Z,encoded:Xn}}else{try{if(!Y)Y=v.UTF8ToString(v._argon2_error_message(uA))}catch(Z){}cA={message:Y,code:uA}}try{if(v._free(C),v._free(fA),v._free(H),v._free(_A),R)v._free(R);if(L)v._free(L)}catch(Z){}if(Y)throw cA;else return cA})}function $(q){return t().then((g)=>{let v=s(q.pass),I=k(g,v),V=v.length,z=q.secret?E(g,q.secret):0,C=q.secret?q.secret.byteLength:0,$A=q.ad?E(g,q.ad):0,iA=q.ad?q.ad.byteLength:0,fA=s(q.encoded),w=k(g,fA),Q=q.type;if(Q===void 0){let R=q.encoded.split("$")[1];if(R)R=R.replace("a","A"),Q=n[R]||n.Argon2d}let H,L;try{L=g._argon2_verify_ext(w,I,V,z,C,$A,iA,Q)}catch(R){H=R}let N;if(L||H){try{if(!H)H=g.UTF8ToString(g._argon2_error_message(L))}catch(R){}N={message:H,code:L}}try{g._free(I),g._free(w)}catch(R){}if(H)throw N;else return N})}function _(){if(t._module)t._module.unloadRuntime(),delete t._promise,delete t._module}return{ArgonType:n,hash:h,verify:$,unloadRuntime:_}})});var c={CURRENT_DATA_VERSION:2,AES:{NAME:"AES-GCM",LENGTH:256,IV_LENGTH:12},ARGON2:{TYPE:"id",ITERATIONS:20,MEMORY_KIB:65536,PARALLELISM:1,HASH_LEN:32},STORAGE_KEY:"secure-local-storage:v2",IDB:{DB_NAME:"SLS_KEYS",STORE:"keys",ID:"deviceKek_v1"},SALT_LEN:16};class x extends Error{constructor(A){super(A);this.name="SlsError"}}class l extends x{constructor(A){super(A);this.name="ValidationError"}}class y extends x{constructor(A="Session locked"){super(A);this.name="LockedError"}}class M extends x{constructor(A){super(A);this.name="ModeError"}}class T extends x{constructor(A="localStorage quota exceeded"){super(A);this.name="StorageFullError"}}class G extends x{constructor(A){super(A);this.name="CryptoError"}}class a extends x{constructor(A){super(A);this.name="ImportError"}}class EA extends x{constructor(A){super(A);this.name="ExportError"}}class FA extends x{constructor(A){super(A);this.name="NotSupportedError"}}function W(A){let n=A instanceof Uint8Array?A:new Uint8Array(A),t="";for(let j=0;j<n.length;j++)t+=String.fromCharCode(n.at(j));if(typeof btoa==="function")return btoa(t);return Buffer.from(t,"binary").toString("base64")}function o(A){if(typeof A!=="string"||A.trim().length===0)throw new l("Base64 input must be a non-empty string");try{let n=A.replace(/\s+/g,"").replace(/-/g,"+").replace(/_/g,"/"),t=n.length%4,j=t===0?n:n+"=".repeat(4-t);if(typeof atob==="function"){let r=atob(j),e=new Uint8Array(r.length);for(let u=0;u<r.length;u++)e[u]=r.charCodeAt(u);return e}let i=Buffer.from(j,"base64");return new Uint8Array(i.buffer,i.byteOffset,i.byteLength)}catch{throw new l("Invalid base64 input")}}function RA(A){if(A.byteOffset===0&&A.byteLength===A.buffer.byteLength&&A.buffer instanceof ArrayBuffer)return A.buffer;return A.slice().buffer}class BA{generateSaltB64(){let A=new Uint8Array(c.SALT_LEN);return crypto.getRandomValues(A),W(A)}async createDek(){try{return await crypto.subtle.generateKey({name:c.AES.NAME,length:c.AES.LENGTH},!0,["encrypt","decrypt","wrapKey","unwrapKey"])}catch(A){throw new G(`Failed to generate DEK: ${A?.message??A}`)}}async encryptData(A,n){try{let t=new Uint8Array(c.AES.IV_LENGTH);crypto.getRandomValues(t);let j=new TextEncoder().encode(JSON.stringify(n)),i=await crypto.subtle.encrypt({name:c.AES.NAME,iv:t},A,RA(j));return{iv:W(t),ciphertext:W(i)}}catch(t){throw new G(`Encryption failed: ${t?.message??t}`)}}async decryptData(A,n,t){if(!n||!t)throw new l("IV and ciphertext are required");let j,i;try{j=o(n),i=o(t)}catch(e){throw e}let r;try{r=await crypto.subtle.decrypt({name:c.AES.NAME,iv:j},A,RA(i))}catch(e){throw new G("Decryption failed: Invalid Data?")}try{return JSON.parse(new TextDecoder().decode(r))}catch{throw new l("Decrypted data is not valid JSON")}}async unwrapDek(A,n,t,j=!1){let i,r;try{i=o(A),r=o(n)}catch(e){throw e}try{return await crypto.subtle.unwrapKey("raw",RA(r),t,{name:c.AES.NAME,iv:i},{name:c.AES.NAME,length:c.AES.LENGTH},j,j?["wrapKey","unwrapKey","encrypt","decrypt"]:["encrypt","decrypt"])}catch(e){throw new G("Key unwrapping failed. Invalid data?")}}async wrapDek(A,n){try{let t=new Uint8Array(c.AES.IV_LENGTH);crypto.getRandomValues(t);let j=await crypto.subtle.wrapKey("raw",A,n,{name:c.AES.NAME,iv:t});return{ivWrap:W(t),wrappedKey:W(j)}}catch(t){throw new G(`wrapKey failed: ${t?.message??t}`)}}}class B{static memoryKey=null;static async getKey(){if(this.memoryKey)return this.memoryKey;if(!globalThis.indexedDB)return this.memoryKey=await this.generateKek(),this.memoryKey;let A=await this.openDB().catch(()=>null);try{if(!A)return this.memoryKey=await this.generateKek(),this.memoryKey;let n=await new Promise((j,i)=>{let e=A.transaction(c.IDB.STORE,"readonly").objectStore(c.IDB.STORE).get(c.IDB.ID);e.onsuccess=()=>j(e.result?.key),e.onerror=()=>i(e.error)});if(n)return this.memoryKey=n,this.memoryKey;let t=await this.generateKek();return await new Promise((j,i)=>{let e=A.transaction(c.IDB.STORE,"readwrite").objectStore(c.IDB.STORE).put({id:c.IDB.ID,key:t});e.onsuccess=()=>j(),e.onerror=()=>i(e.error)}).catch(()=>{}),this.memoryKey=t,this.memoryKey}catch{if(!this.memoryKey)this.memoryKey=await this.generateKek();return this.memoryKey}finally{if(A)A.close()}}static async rotateKey(){let A=await this.generateKek();if(!globalThis.indexedDB)return this.memoryKey=A,A;let n=await this.openDB().catch(()=>null);try{if(!n)return this.memoryKey=A,A;return await new Promise((t,j)=>{let r=n.transaction(c.IDB.STORE,"readwrite").objectStore(c.IDB.STORE).put({id:c.IDB.ID,key:A});r.onsuccess=()=>t(),r.onerror=()=>j(r.error)}),this.memoryKey=A,A}catch{return this.memoryKey=A,A}finally{if(n)n.close()}}static async deletePersistent(){if(this.memoryKey=null,!globalThis.indexedDB)return;await new Promise((A,n)=>{let t=indexedDB.deleteDatabase(c.IDB.DB_NAME);t.onsuccess=()=>A(),t.onerror=()=>n(t.error)}).catch(()=>{})}static async generateKek(){return await crypto.subtle.generateKey({name:c.AES.NAME,length:c.AES.LENGTH},!1,["wrapKey","unwrapKey"])}static openDB(){return new Promise((A,n)=>{let t=indexedDB.open(c.IDB.DB_NAME,1);t.onupgradeneeded=()=>{t.result.createObjectStore(c.IDB.STORE,{keyPath:"id"})},t.onsuccess=()=>A(t.result),t.onerror=()=>n(new FA(t.error?.message??"IndexedDB error"))})}}var oA=bA(Pn(),1);function Ht(A){if(A.byteOffset===0&&A.byteLength===A.buffer.byteLength&&A.buffer instanceof ArrayBuffer)return A.buffer;return A.slice().buffer}async function O(A,n,t=c.ARGON2.ITERATIONS){if(typeof A!=="string"||A.length===0)throw new l("Password must be a non-empty string");if(!(n instanceof Uint8Array)||n.byteLength<c.SALT_LEN)throw new l(`Salt must be Uint8Array with length >= ${c.SALT_LEN}`);let j=64;if(!Number.isInteger(t)||t<1||t>j)throw new l(`iterations must be an integer in [1, ${j}]`);let i;try{i=await oA.hash({pass:A,salt:n,time:t,mem:c.ARGON2.MEMORY_KIB,hashLen:c.ARGON2.HASH_LEN,parallelism:c.ARGON2.PARALLELISM,type:oA.ArgonType.Argon2id})}catch(r){throw new G(`Argon2 derivation failed: ${r?.message??r}`)}if(!i?.hash)throw new G("Argon2 returned no hash");try{return await crypto.subtle.importKey("raw",Ht(i.hash),{name:c.AES.NAME,length:c.AES.LENGTH},!1,["wrapKey","unwrapKey"])}catch(r){throw new G(`Failed to import derived key: ${r?.message??r}`)}}class CA{key=null;saltB64=null;rounds=null;set(A,n,t){this.key=A,this.saltB64=n,this.rounds=t}match(A,n){if(!this.key)return null;if(this.saltB64===A&&this.rounds===n)return this.key;return null}clear(){this.key=null,this.saltB64=null,this.rounds=null}}function at(A){try{return new Blob([A]).size}catch{return A.length}}class QA{key;constructor(A=c.STORAGE_KEY){this.key=A}get(){let A=localStorage.getItem(this.key);if(!A)return null;try{return JSON.parse(A)}catch{return null}}_isQuotaExceeded(A){let n=A;return n?.name==="QuotaExceededError"||n?.name==="NS_ERROR_DOM_QUOTA_REACHED"||typeof n?.message==="string"&&/quota/i.test(n.message)||n?.code===22||n?.code===1014}set(A){let n=JSON.stringify(A);try{if(localStorage.setItem(this.key,n),localStorage.getItem(this.key)!==n)throw new T("Failed to persist data")}catch(t){if(this._isQuotaExceeded(t))throw new T(`localStorage quota exceeded (${at(n)} bytes)`);let j=t?.message??String(t);throw new T(`Failed to persist data: ${j}`)}}clear(){try{localStorage.removeItem(this.key)}catch{}}}function Jn(A){let n=new WeakSet,t=(j,i)=>{let r=typeof i;if(r==="function"||r==="symbol")throw new l("Data must be JSON-serializable (no functions/symbols)");if(i&&r==="object"){let e=i;if(n.has(e))throw new l("Data must be JSON-serializable (no circular references)");n.add(e)}return i};try{return JSON.parse(JSON.stringify(A,t))}catch(j){if(j instanceof l)throw j;throw new l("Data must be JSON-serializable")}}function YA(A){let n=!1,t=A,j=new WeakMap;function i(){let E=(k)=>{if(!k||typeof k!=="object")return;let s=k;for(let h of Object.keys(s)){let $=s[h];if($&&typeof $==="object")E($);s[h]=null}};E(t),n=!0,t={},j=new WeakMap}let r=()=>new l("SecureDataView is read-only; mutate via setData()"),e=(E)=>{if(!E||typeof E!=="object")return E;let k=j.get(E);if(k)return k;let s=new Proxy(E,{get(h,$){if(n)throw new y("Decrypted data was cleared");let _=h[$];return typeof _==="object"&&_!==null?e(_):_},set(){throw r()},defineProperty(){throw r()},deleteProperty(){throw r()},ownKeys(h){if(n)throw new y("Decrypted data was cleared");return Reflect.ownKeys(h)},getOwnPropertyDescriptor(h,$){if(n)throw new y("Decrypted data was cleared");if(Object.prototype.hasOwnProperty.call(h,$))return{configurable:!0,enumerable:!0,writable:!1,value:h[$]};return},has(h,$){if(n)throw new y("Decrypted data was cleared");return Reflect.has(h,$)}});return j.set(E,s),s};return new Proxy({},{get(E,k){if(k==="clear")return i;if(n)throw new y("Decrypted data was cleared");let s=t[k];return typeof s==="object"&&s!==null?e(s):s},set(){throw r()},defineProperty(){throw r()},deleteProperty(){throw r()},ownKeys(){if(n)throw new y("Decrypted data was cleared");return[...Object.keys(t),"clear"]},getOwnPropertyDescriptor(E,k){if(k==="clear")return{configurable:!0,enumerable:!0,writable:!1,value:i};if(n)throw new y("Decrypted data was cleared");if(Object.prototype.hasOwnProperty.call(t,k))return{configurable:!0,enumerable:!0,writable:!1,value:t[k]};return},has(E,k){if(k==="clear")return!0;if(n)throw new y("Decrypted data was cleared");return Object.prototype.hasOwnProperty.call(t,k)}})}class IA{store;enc=new BA;session=new CA;config=null;dek=null;ready;constructor(A){this.store=new QA(A?.storageKey),this.ready=this.initialize()}isUsingMasterPassword(){return(this.config?.header.rounds??1)>1}async unlock(A){if(await this.ready,!this.config)throw new a("No data to unlock");if(!this.isUsingMasterPassword())return;let{salt:n,rounds:t}=this.config.header,j=await O(A,o(n),t);try{this.session.set(j,n,t),await this.unwrapDekWithKek(j,!1)}catch{throw this.session.clear(),new l("Invalid master password")}}async setMasterPassword(A){if(await this.ready,this.requireConfig(),this.isUsingMasterPassword())throw new M("Master password already set; use rotateMasterPassword()");if(typeof A!=="string"||A.length===0)throw new l("masterPassword must be a non-empty string");let n=await B.getKey();await this.unwrapDekWithKek(n,!0);let t=this.enc.generateSaltB64(),j=await O(A,o(t)),i=await this.enc.wrapDek(this.dek,j);this.config.header={v:c.CURRENT_DATA_VERSION,salt:t,rounds:c.ARGON2.ITERATIONS,iv:i.ivWrap,wrappedKey:i.wrappedKey},this.session.set(j,t,c.ARGON2.ITERATIONS),this.dek=await this.enc.unwrapDek(i.ivWrap,i.wrappedKey,j,!1),this.persist()}async removeMasterPassword(){if(await this.ready,this.requireConfig(),!this.isUsingMasterPassword())throw new M("No master password is set");this.requireUnlocked();let A=await B.getKey();await this.unwrapDekWithKek(this.sessionKekOrThrow(),!0);let{ivWrap:n,wrappedKey:t}=await this.enc.wrapDek(this.dek,A);this.config.header={v:c.CURRENT_DATA_VERSION,salt:"",rounds:1,iv:n,wrappedKey:t},this.dek=await this.enc.unwrapDek(n,t,A,!1),this.session.clear(),this.persist()}async rotateMasterPassword(A,n){if(await this.ready,this.requireConfig(),typeof n!=="string"||n.length===0)throw new l("newMasterPassword must be a non-empty string");if(!this.isUsingMasterPassword()){await this.unlock(A),await this.setMasterPassword(n);return}await this.unlock(A),this.requireUnlocked(),await this.unwrapDekWithKek(this.sessionKekOrThrow(),!0);let t=this.enc.generateSaltB64(),j=c.ARGON2.ITERATIONS,i=await O(n,o(t),j),{ivWrap:r,wrappedKey:e}=await this.enc.wrapDek(this.dek,i);this.config.header={v:c.CURRENT_DATA_VERSION,salt:t,rounds:j,iv:r,wrappedKey:e},this.session.set(i,t,j),this.dek=await this.enc.unwrapDek(r,e,i,!1),this.persist()}lock(){this.session.clear(),this.dek=null}async rotateKeys(){if(await this.ready,this.requireConfig(),this.isUsingMasterPassword())throw new M("rotateKeys is allowed only in password-less mode");let A=await B.getKey();await this.unwrapDekWithKek(A,!1);let n=await this.enc.decryptData(this.dek,this.config.data.iv,this.config.data.ciphertext),t=await this.enc.createDek(),{iv:j,ciphertext:i}=await this.enc.encryptData(t,n),r=await B.rotateKey(),{ivWrap:e,wrappedKey:u}=await this.enc.wrapDek(t,r);this.config.header={v:c.CURRENT_DATA_VERSION,salt:"",rounds:1,iv:e,wrappedKey:u},this.config.data={iv:j,ciphertext:i},this.dek=await this.enc.unwrapDek(e,u,r,!1);for(let E of Object.keys(n))n[E]=null;this.persist()}async getData(){if(await this.ready,this.requireConfig(),await this.ensureDekLoaded(),!this.config.data.iv||!this.config.data.ciphertext)return YA({});let A=await this.enc.decryptData(this.dek,this.config.data.iv,this.config.data.ciphertext);if(!A||typeof A!=="object"||Array.isArray(A))throw new l("Stored data must be a plain object");return YA(A)}async setData(A){await this.ready,this.requireConfig(),await this.ensureDekLoaded();let n=Jn(A),{iv:t,ciphertext:j}=await this.enc.encryptData(this.dek,n);this.config.data={iv:t,ciphertext:j},this.persist()}async exportData(A){if(await this.ready,this.requireConfig(),!A&&this.isUsingMasterPassword()){let n=structuredClone(this.config);return n.header.mPw=!0,JSON.stringify(n)}if(!A&&!this.isUsingMasterPassword())throw new EA("Export password required in device mode");try{let n=this.enc.generateSaltB64(),t=await O(A,o(n));if(this.isUsingMasterPassword())await this.unwrapDekWithKek(this.sessionKekOrThrow(),!0);else{let e=await B.getKey();await this.unwrapDekWithKek(e,!0)}let{ivWrap:j,wrappedKey:i}=await this.enc.wrapDek(this.dek,t),r={header:{v:c.CURRENT_DATA_VERSION,salt:n,rounds:c.ARGON2.ITERATIONS,iv:j,wrappedKey:i,mPw:!1},data:this.config.data};return JSON.stringify(r)}catch(n){throw new EA(n?.message??"Export failed")}}async importData(A,n){await this.ready;let t;try{t=JSON.parse(A)}catch{throw new a("Invalid import JSON")}if(t.header.v!==c.CURRENT_DATA_VERSION)throw new a(`Unsupported export version ${t.header.v}`);if(t.header.mPw===!0||t.header.rounds>1&&t.header.mPw!==!1){if(!n)throw new a("Master password required to import");let i=await O(n,o(t.header.salt),t.header.rounds);try{await this.enc.unwrapDek(t.header.iv,t.header.wrappedKey,i,!1)}catch{throw new a("Invalid master password")}this.config=t,this.dek=null,this.session.clear(),this.persist();return}if(!n)throw new a("Export password required to import");try{let i=await O(n,o(t.header.salt),t.header.rounds),r=await this.enc.unwrapDek(t.header.iv,t.header.wrappedKey,i,!0),e=await B.getKey(),{ivWrap:u,wrappedKey:E}=await this.enc.wrapDek(r,e);this.config={header:{v:c.CURRENT_DATA_VERSION,salt:"",rounds:1,iv:u,wrappedKey:E},data:t.data},this.dek=await this.enc.unwrapDek(u,E,e,!1),this.session.clear(),this.persist()}catch(i){throw new a("Invalid export password or corrupted export data")}}async clear(){await this.ready,this.session.clear(),this.dek=null,this.store.clear(),await B.deletePersistent(),await this.initialize(!0)}async initialize(A=!1){let n=(j)=>{if(!j)return!1;let{header:i,data:r}=j;if(!i||i.v!==c.CURRENT_DATA_VERSION)return!1;if(typeof i.rounds!=="number"||i.rounds<1)return!1;if(typeof i.iv!=="string"||typeof i.wrappedKey!=="string")return!1;if(!r||typeof r.iv!=="string"||typeof r.ciphertext!=="string")return!1;if(i.rounds===1){if(i.salt!=="")return!1}else if(typeof i.salt!=="string"||i.salt.length===0)return!1;try{if(o(i.iv),o(i.wrappedKey),r.iv)o(r.iv);if(r.ciphertext)o(r.ciphertext)}catch{return!1}return!0};if(A){let j=await this.enc.createDek(),i=await B.getKey(),{ivWrap:r,wrappedKey:e}=await this.enc.wrapDek(j,i),u=await this.enc.unwrapDek(r,e,i,!1),{iv:E,ciphertext:k}=await this.enc.encryptData(u,{});this.config={header:{v:c.CURRENT_DATA_VERSION,salt:"",rounds:1,iv:r,wrappedKey:e},data:{iv:E,ciphertext:k}},this.dek=u,this.persist();return}let t=this.store.get();if(!n(t)){await this.initialize(!0);return}if(this.config=t,!this.isUsingMasterPassword()){let j=await B.getKey();try{this.dek=await this.enc.unwrapDek(t.header.iv,t.header.wrappedKey,j,!1)}catch{throw new l("Failed to unwrap DEK using device key. Tampered data?")}}}persist(){this.store.set(this.config)}requireConfig(){if(!this.config)throw new a("No configuration present")}requireUnlocked(){if(!this.dek)throw new y}sessionKekOrThrow(){let{salt:A,rounds:n}=this.config.header,t=this.session.match(A,n);if(!t)throw new y("Session locked.");return t}async ensureDekLoaded(){if(this.dek)return;if(this.isUsingMasterPassword()){let A=this.sessionKekOrThrow();await this.unwrapDekWithKek(A,!1)}else{let A=await B.getKey();await this.unwrapDekWithKek(A,!1)}}async unwrapDekWithKek(A,n){this.dek=await this.enc.unwrapDek(this.config.header.iv,this.config.header.wrappedKey,A,n)}}function Ut(A){return new IA(A)}export{Ut as default,IA as SecureLocalStorage};

//# debugId=8764F77AB2893B6464756E2164756E21
